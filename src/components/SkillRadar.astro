---
import type { RiderSkills, SkillKey } from "../data/types";
import { SKILL_LABELS, SKILL_COLORS } from "../data/types";

interface Props {
  skills: RiderSkills;
  size?: number;
}

const { skills, size = 180 } = Astro.props;
const center = size / 2;
const radius = (size / 2) - 20;
const skillKeys = Object.keys(SKILL_LABELS) as SkillKey[];
const numSkills = skillKeys.length;

function getPoint(index: number, value: number): [number, number] {
  const angle = (Math.PI * 2 * index) / numSkills - Math.PI / 2;
  const r = (value / 100) * radius;
  return [center + r * Math.cos(angle), center + r * Math.sin(angle)];
}

const gridLevels = [25, 50, 75, 100];
const dataPoints = skillKeys.map((key, i) => getPoint(i, skills[key]));
const polygonPoints = dataPoints.map(([x, y]) => `${x},${y}`).join(" ");
---

<svg width={size} height={size} viewBox={`0 0 ${size} ${size}`} class="radar">
  {gridLevels.map((level) => {
    const points = skillKeys
      .map((_, i) => getPoint(i, level))
      .map(([x, y]) => `${x},${y}`)
      .join(" ");
    return <polygon points={points} class="grid-line" />;
  })}

  {skillKeys.map((_, i) => {
    const [x, y] = getPoint(i, 100);
    return <line x1={center} y1={center} x2={x} y2={y} class="grid-spoke" />;
  })}

  <polygon points={polygonPoints} class="data-polygon" />

  {skillKeys.map((key, i) => {
    const [x, y] = getPoint(i, skills[key]);
    return <circle cx={x} cy={y} r="3" fill={SKILL_COLORS[key]} />;
  })}

  {skillKeys.map((key, i) => {
    const [x, y] = getPoint(i, 115);
    return (
      <text x={x} y={y} class="radar-label" text-anchor="middle" dominant-baseline="middle">
        {SKILL_LABELS[key].slice(0, 3).toUpperCase()}
      </text>
    );
  })}
</svg>

<style>
  .radar {
    display: block;
    margin: 0 auto;
  }

  .grid-line {
    fill: none;
    stroke: var(--border);
    stroke-width: 0.5;
  }

  .grid-spoke {
    stroke: var(--border);
    stroke-width: 0.5;
  }

  .data-polygon {
    fill: rgba(255, 215, 0, 0.15);
    stroke: var(--accent);
    stroke-width: 1.5;
  }

  .radar-label {
    font-size: 8px;
    fill: var(--text-secondary);
    font-family: var(--font-sans);
    font-weight: 600;
    letter-spacing: 0.05em;
  }
</style>
